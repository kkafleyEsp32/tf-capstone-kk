pipeline {
  agent any
  triggers {
    pollSCM('H/3 * * * *')
  }
  stages {
    stage('init') {
      steps {
        sh 'terraform init'
      }
    }
    stage('validate') {
      steps {
        sh 'terraform validate'
      }
    }
    stage('format') {
      steps {
        sh 'terraform fmt'
      }
    }
    stage('plan') {
      steps {
        sh 'terraform plan'
      }
    }
    stage('Approval') {
      steps {
        input message: 'Approve Terraform Apply?'
      }
    }
    stage('Terraform Apply') {
      steps {
        sh 'terraform apply -auto-approve'
      }
    }
  }
}